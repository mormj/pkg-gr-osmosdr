From 1693e4e9d802b8420c022b7c64a7d40551d37884 Mon Sep 17 00:00:00 2001
From: Lukas Lao Beyer <lukas@electronics.kitchen>
Date: Sat, 22 Apr 2017 13:42:34 -0400
Subject: [PATCH 095/131] FreeSRP: Add support for multiple devices in
 get_devices

---
 lib/freesrp/freesrp_common.cc | 18 +++++++++---------
 1 file changed, 9 insertions(+), 9 deletions(-)

diff --git a/lib/freesrp/freesrp_common.cc b/lib/freesrp/freesrp_common.cc
index 77db220..cbbf1c3 100644
--- a/lib/freesrp/freesrp_common.cc
+++ b/lib/freesrp/freesrp_common.cc
@@ -116,18 +116,18 @@ vector<string> freesrp_common::get_devices()
 {
     vector<string> devices;
 
-    try
-    {
-        ::FreeSRP::FreeSRP srp;
+    vector<string> serial_numbers = ::FreeSRP::FreeSRP::list_connected();
 
-        string str;
-        str = "freesrp=0,label='FreeSRP'";
+    int index = 0;
 
-        devices.push_back(str);
-    }
-    catch(const ConnectionError &err)
+    for(string &serial : serial_numbers)
     {
-        // No FreeSRP found.
+	index++;
+
+	string str;
+	str = "freesrp=" + serial + ",label='FreeSRP " + to_string(index) + "'";
+
+	devices.push_back(str);
     }
 
     return devices;
-- 
2.20.1

