From 3916b5bc4f9ed504106cf0845e6daa077a84764c Mon Sep 17 00:00:00 2001
From: Dimitri Stolnikov <horiz0n@gmx.net>
Date: Tue, 12 May 2015 23:30:45 +0200
Subject: [PATCH 24/48] cmake: added ENABLE_NONFREE option to enable nonfree
 components.

---
 CMakeLists.txt     | 12 ++++++++++++
 lib/CMakeLists.txt |  4 +++-
 2 files changed, 15 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 1a288aa..f715414 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -33,6 +33,8 @@ if(NOT CMAKE_BUILD_TYPE)
 endif(NOT CMAKE_BUILD_TYPE)
 set(CMAKE_BUILD_TYPE ${CMAKE_BUILD_TYPE} CACHE STRING "")
 
+set(ENABLE_NONFREE FALSE CACHE BOOL "Enable or disable nonfree components.")
+
 # Set the version information here
 set(VERSION_INFO_MAJOR_VERSION 0)
 set(VERSION_INFO_API_COMPAT    1)
@@ -157,7 +159,9 @@ find_package(GnuradioFCDPP)
 find_package(LibOsmoSDR)
 find_package(LibRTLSDR)
 find_package(LibMiriSDR)
+if(ENABLE_NONFREE)
 find_package(LibSDRplay)
+endif(ENABLE_NONFREE)
 find_package(LibHackRF)
 find_package(LibAIRSPY)
 find_package(LibbladeRF)
@@ -274,5 +278,13 @@ INSTALL(
 # Print Summary
 ########################################################################
 GR_PRINT_COMPONENT_SUMMARY()
+if(ENABLE_NONFREE)
+MESSAGE(STATUS
+  "NONFREE components have been enabled. The resulting
+   binaries cannot be distributed under GPL terms.
+  "
+)
+endif(ENABLE_NONFREE)
+
 MESSAGE(STATUS "Building for version: ${VERSION} / ${LIBVER}")
 MESSAGE(STATUS "Using install prefix: ${CMAKE_INSTALL_PREFIX}")
diff --git a/lib/CMakeLists.txt b/lib/CMakeLists.txt
index 003686d..ae4649c 100644
--- a/lib/CMakeLists.txt
+++ b/lib/CMakeLists.txt
@@ -185,10 +185,12 @@ endif(ENABLE_MIRI)
 ########################################################################
 # Setup SDRplay component
 ########################################################################
-GR_REGISTER_COMPONENT("SDRplay RSP" ENABLE_SDRPLAY LIBSDRPLAY_FOUND)
+if(ENABLE_NONFREE)
+GR_REGISTER_COMPONENT("SDRplay RSP (NONFREE)" ENABLE_SDRPLAY LIBSDRPLAY_FOUND)
 if(ENABLE_SDRPLAY)
 GR_INCLUDE_SUBDIRECTORY(sdrplay)
 endif(ENABLE_SDRPLAY)
+endif(ENABLE_NONFREE)
 
 ########################################################################
 # Setup HackRF component
-- 
2.1.4

