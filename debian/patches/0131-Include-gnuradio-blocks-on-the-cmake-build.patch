From f3905d3510dfb3851f946f097a9e2ddaa5fb333b Mon Sep 17 00:00:00 2001
From: Igor Freire <igor.auad@gmail.com>. A. Maitland Bottoms <bottoms@debian.org>
Date: Thu, 28 Aug 2019 22:55:44 -0400
Subject: [PATCH 131/131] Include gnuradio-blocks on the cmake build

---
 CMakeLists.txt     | 4 ++--
 lib/CMakeLists.txt | 1 +
 2 files changed, 3 insertions(+), 2 deletions(-)

--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -112,7 +112,7 @@
 ########################################################################
 # Install directories
 ########################################################################
-find_package(Gnuradio REQUIRED) # Side effect of MODULE_PATH getting prepended with system components
+find_package(Gnuradio REQUIRED COMPONENTS blocks) # Side effect of MODULE_PATH getting prepended with system components
 list(REVERSE CMAKE_MODULE_PATH)
 set(MIN_GR_VERSION "3.8")
 if("${Gnuradio_VERSION}" VERSION_LESS MIN_GR_VERSION)
@@ -165,21 +165,19 @@
 ########################################################################
 # Find build dependencies
 ########################################################################
-set(GR_REQUIRED_COMPONENTS RUNTIME PMT BLOCKS)
-
-#[[find_package(gnuradio-blocks PATHS ${GR_PREFIX}/lib/cmake/gnuradio/)
+find_package(gnuradio-blocks PATHS ${Gnuradio_DIR})
 message(STATUS "Found Block Block: ${gnuradio-blocks_FOUND}")
 
-find_package(gnuradio-pmt PATHS ${GR_PREFIX}/lib/cmake/gnuradio/)
+#[[find_package(gnuradio-pmt PATHS ${Gnuradio_DIR})
 message(STATUS "Found PMT Block: ${gnuradio-pmt_FOUND}")
 
-find_package(gnuradio-runtime PATHS ${GR_PREFIX}/lib/cmake/gnuradio/)
+find_package(gnuradio-runtime PATHS ${Gnuradio_DIR})
 message(STATUS "Found Runtime Block: ${gnuradio-runtime_FOUND}")
 
 # Software Components part of GNU Radio - These should all be present for a default install
 message(STATUS " Searching for IQ Balance...")
 #find_package(Gnuradio COMPONENTS iqbalance REQUIRED)
-find_package(gnuradio-iqbalance PATHS ${GR_PREFIX}/lib/cmake/iqbalance)
+find_package(gnuradio-iqbalance NAMES gr-fcdproplus)
 message (STATUS "Found IQ Balance: ${gnuradio-iqbalance_FOUND}")
 
 message(STATUS " Searching for UHD Drivers...")
@@ -197,7 +195,6 @@
 find_package(volk PATHS ${GR_PREFIX}/lib/cmake/volk)
 message (STATUS "Found Volk: ${volk_FOUND}") ]]#
 
-find_package(GnuradioIQBalance)
 find_package(UHD)
 find_package(GnuradioUHD)
 find_package(LibOsmoSDR)
--- a/lib/CMakeLists.txt
+++ b/lib/CMakeLists.txt
@@ -51,6 +51,7 @@
 
 GR_OSMOSDR_APPEND_LIBS(
     ${Boost_LIBRARIES}
+    gnuradio::gnuradio-blocks
     ${GNURADIO_ALL_LIBRARIES}
 )
 
@@ -136,7 +137,7 @@
 ########################################################################
 # Setup File component
 ########################################################################
-GR_REGISTER_COMPONENT("IQ File Source & Sink" ENABLE_FILE GNURADIO_BLOCKS_FOUND)
+GR_REGISTER_COMPONENT("IQ File Source & Sink" ENABLE_FILE gnuradio-blocks_FOUND)
 if(ENABLE_FILE)
 GR_INCLUDE_SUBDIRECTORY(file)
 endif(ENABLE_FILE)
@@ -152,7 +153,7 @@
 ########################################################################
 # Setup RTL_TCP component
 ########################################################################
-GR_REGISTER_COMPONENT("RTLSDR TCP Client" ENABLE_RTL_TCP GNURADIO_BLOCKS_FOUND)
+GR_REGISTER_COMPONENT("RTLSDR TCP Client" ENABLE_RTL_TCP gnuradio-blocks_FOUND)
 if(ENABLE_RTL_TCP)
 GR_INCLUDE_SUBDIRECTORY(rtl_tcp)
 endif(ENABLE_RTL_TCP)
