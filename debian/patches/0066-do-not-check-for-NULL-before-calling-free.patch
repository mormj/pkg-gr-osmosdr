From ac15e7897bb740d083c71bf02729467ca6528635 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Ji=C5=99=C3=AD=20Pinkava?= <j-pi@seznam.cz>
Date: Sun, 4 Oct 2015 14:11:29 +0200
Subject: [PATCH 066/131] do not check for NULL before calling free

---
 lib/hackrf/hackrf_sink_c.cc     | 12 ++++--------
 lib/hackrf/hackrf_source_c.cc   |  3 +--
 lib/miri/miri_source_c.cc       |  3 +--
 lib/osmosdr/osmosdr_src_c.cc    |  3 +--
 lib/rtl/rtl_source_c.cc         |  3 +--
 lib/sdrplay/sdrplay_source_c.cc |  7 ++-----
 6 files changed, 10 insertions(+), 21 deletions(-)

diff --git a/lib/hackrf/hackrf_sink_c.cc b/lib/hackrf/hackrf_sink_c.cc
index ee3745b..8ca1b3e 100644
--- a/lib/hackrf/hackrf_sink_c.cc
+++ b/lib/hackrf/hackrf_sink_c.cc
@@ -84,10 +84,8 @@ static inline bool cb_init(circular_buffer_t *cb, size_t capacity, size_t sz)
 
 static inline void cb_free(circular_buffer_t *cb)
 {
-  if (cb->buffer) {
-    free(cb->buffer);
-    cb->buffer = NULL;
-  }
+  free(cb->buffer);
+  cb->buffer = NULL;
   // clear out other fields too, just to be safe
   cb->buffer_end = 0;
   cb->capacity = 0;
@@ -278,10 +276,8 @@ hackrf_sink_c::~hackrf_sink_c ()
     }
   }
 
-  if (_buf) {
-    free(_buf);
-    _buf = NULL;
-  }
+  free(_buf);
+  _buf = NULL;
 
   cb_free( &_cbuf );
 }
diff --git a/lib/hackrf/hackrf_source_c.cc b/lib/hackrf/hackrf_source_c.cc
index 03a43d4..4211603 100644
--- a/lib/hackrf/hackrf_source_c.cc
+++ b/lib/hackrf/hackrf_source_c.cc
@@ -260,8 +260,7 @@ hackrf_source_c::~hackrf_source_c ()
 
   if (_buf) {
     for(unsigned int i = 0; i < _buf_num; ++i) {
-      if (_buf[i])
-        free(_buf[i]);
+      free(_buf[i]);
     }
 
     free(_buf);
diff --git a/lib/miri/miri_source_c.cc b/lib/miri/miri_source_c.cc
index ba6037f..c9f81fa 100644
--- a/lib/miri/miri_source_c.cc
+++ b/lib/miri/miri_source_c.cc
@@ -158,8 +158,7 @@ miri_source_c::~miri_source_c ()
 
   if (_buf) {
     for(unsigned int i = 0; i < _buf_num; ++i) {
-      if (_buf[i])
-        free(_buf[i]);
+      free(_buf[i]);
     }
 
     free(_buf);
diff --git a/lib/osmosdr/osmosdr_src_c.cc b/lib/osmosdr/osmosdr_src_c.cc
index 03b9e3b..de65373 100644
--- a/lib/osmosdr/osmosdr_src_c.cc
+++ b/lib/osmosdr/osmosdr_src_c.cc
@@ -157,8 +157,7 @@ osmosdr_src_c::~osmosdr_src_c ()
 
   if (_buf) {
     for(unsigned int i = 0; i < _buf_num; ++i) {
-      if (_buf[i])
-        free(_buf[i]);
+      free(_buf[i]);
     }
 
     free(_buf);
diff --git a/lib/rtl/rtl_source_c.cc b/lib/rtl/rtl_source_c.cc
index ed307bf..93328b8 100644
--- a/lib/rtl/rtl_source_c.cc
+++ b/lib/rtl/rtl_source_c.cc
@@ -257,8 +257,7 @@ rtl_source_c::~rtl_source_c ()
 
   if (_buf) {
     for(unsigned int i = 0; i < _buf_num; ++i) {
-      if (_buf[i])
-        free(_buf[i]);
+      free(_buf[i]);
     }
 
     free(_buf);
diff --git a/lib/sdrplay/sdrplay_source_c.cc b/lib/sdrplay/sdrplay_source_c.cc
index 81926a3..9a9ee40 100644
--- a/lib/sdrplay/sdrplay_source_c.cc
+++ b/lib/sdrplay/sdrplay_source_c.cc
@@ -142,11 +142,8 @@ sdrplay_source_c::sdrplay_source_c (const std::string &args)
  */
 sdrplay_source_c::~sdrplay_source_c ()
 {
-   if (_dev != NULL)
-   {
-      free(_dev);
-      _dev = NULL;
-   }
+   free(_dev);
+   _dev = NULL;
    _buf_mutex.lock();
    if (_running)
    {
-- 
2.20.1

